<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>K2 vs Alpine.js Benchmark</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 1000px;
      margin: 0 auto;
      padding: 2rem;
      background: #0f0f0f;
      color: #e0e0e0;
    }
    h1 { color: #4ade80; border-bottom: 2px solid #4ade80; padding-bottom: 0.5rem; }
    h2 { color: #60a5fa; margin-top: 2rem; }
    .card {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 1.5rem;
      margin: 1rem 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
    }
    th, td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid #333;
    }
    th { background: #2a2a2a; color: #4ade80; }
    .faster { color: #4ade80; font-weight: bold; }
    .slower { color: #f87171; }
    .same { color: #fbbf24; }
    button {
      background: #4ade80;
      color: #0f0f0f;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      margin: 0.25rem;
    }
    button:hover { background: #22c55e; }
    button:disabled { background: #444; color: #888; cursor: not-allowed; }
    .size-compare {
      display: flex;
      gap: 2rem;
      flex-wrap: wrap;
    }
    .size-box {
      flex: 1;
      min-width: 200px;
      padding: 1rem;
      background: #2a2a2a;
      border-radius: 4px;
      text-align: center;
    }
    .size-value {
      font-size: 2rem;
      font-weight: bold;
      color: #4ade80;
    }
    .size-label {
      color: #888;
      margin-top: 0.5rem;
    }
    #log {
      background: #1e1e1e;
      padding: 1rem;
      border-radius: 4px;
      font-family: monospace;
      font-size: 0.9rem;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 1rem;
    }
    .log-entry { margin: 0.25rem 0; }
    .log-entry.running { color: #60a5fa; }
    .log-entry.complete { color: #4ade80; }
    .log-entry.error { color: #f87171; }
    iframe { display: none; }
    .links { display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem; }
    .links a { color: #4ade80; }
    .links a.alpine { color: #60a5fa; }
  </style>
</head>
<body>
  <h1>K2 vs Alpine.js Benchmark</h1>
  <p>Performance comparison between K2 (TC39 Signals) and Alpine.js</p>

  <div class="card">
    <h2>Bundle Size Comparison</h2>
    <div class="size-compare">
      <div class="size-box">
        <div class="size-value">~3.6KB</div>
        <div class="size-label">K2 (gzipped)</div>
      </div>
      <div class="size-box">
        <div class="size-value">~14KB</div>
        <div class="size-label">Alpine.js (gzipped)</div>
      </div>
      <div class="size-box">
        <div class="size-value">~7KB</div>
        <div class="size-label">Petite-Vue (gzipped)</div>
      </div>
    </div>
    <p style="margin-top: 1rem; color: #888;">K2 is ~4x smaller than Alpine.js and ~2x smaller than Petite-Vue!</p>
  </div>

  <div class="card">
    <h2>Performance Benchmarks</h2>
    <p>Each benchmark runs multiple times and reports the average.</p>
    <button id="runAll" onclick="runAllBenchmarks()">Run All Benchmarks</button>
    <button onclick="clearResults()">Clear Results</button>

    <table id="results">
      <thead>
        <tr>
          <th>Benchmark</th>
          <th>K2</th>
          <th>Alpine.js</th>
          <th>Winner</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Create 1,000 rows</td>
          <td id="signal-create">-</td>
          <td id="alpine-create">-</td>
          <td id="winner-create">-</td>
        </tr>
        <tr>
          <td>Create 10,000 rows</td>
          <td id="signal-create10k">-</td>
          <td id="alpine-create10k">-</td>
          <td id="winner-create10k">-</td>
        </tr>
        <tr>
          <td>Append 1,000 rows</td>
          <td id="signal-append">-</td>
          <td id="alpine-append">-</td>
          <td id="winner-append">-</td>
        </tr>
        <tr>
          <td>Update every 10th row</td>
          <td id="signal-update">-</td>
          <td id="alpine-update">-</td>
          <td id="winner-update">-</td>
        </tr>
        <tr>
          <td>Select row</td>
          <td id="signal-select">-</td>
          <td id="alpine-select">-</td>
          <td id="winner-select">-</td>
        </tr>
        <tr>
          <td>Remove row</td>
          <td id="signal-remove">-</td>
          <td id="alpine-remove">-</td>
          <td id="winner-remove">-</td>
        </tr>
        <tr>
          <td>Swap rows</td>
          <td id="signal-swap">-</td>
          <td id="alpine-swap">-</td>
          <td id="winner-swap">-</td>
        </tr>
        <tr>
          <td>Clear all rows</td>
          <td id="signal-clear">-</td>
          <td id="alpine-clear">-</td>
          <td id="winner-clear">-</td>
        </tr>
      </tbody>
    </table>

    <div id="log"></div>
  </div>

  <div class="card">
    <h2>Run Individual Benchmarks</h2>
    <p>Click to open benchmark pages directly:</p>

    <h3 style="color: #4ade80; margin-top: 1rem;">K2</h3>
    <div class="links">
      <a href="k2/create-1000.html" target="_blank">Create 1000</a>
      <a href="k2/create-10000.html" target="_blank">Create 10000</a>
      <a href="k2/append-1000.html" target="_blank">Append 1000</a>
      <a href="k2/update-1000.html" target="_blank">Update</a>
      <a href="k2/select-row.html" target="_blank">Select</a>
      <a href="k2/remove-row.html" target="_blank">Remove</a>
      <a href="k2/swap-1000.html" target="_blank">Swap</a>
      <a href="k2/clear-1000.html" target="_blank">Clear</a>
    </div>

    <h3 style="color: #60a5fa; margin-top: 1rem;">Alpine.js</h3>
    <div class="links">
      <a class="alpine" href="alpine/create-1000.html" target="_blank">Create 1000</a>
      <a class="alpine" href="alpine/create-10000.html" target="_blank">Create 10000</a>
      <a class="alpine" href="alpine/append-1000.html" target="_blank">Append 1000</a>
      <a class="alpine" href="alpine/update-1000.html" target="_blank">Update</a>
      <a class="alpine" href="alpine/select-row.html" target="_blank">Select</a>
      <a class="alpine" href="alpine/remove-row.html" target="_blank">Remove</a>
      <a class="alpine" href="alpine/swap-1000.html" target="_blank">Swap</a>
      <a class="alpine" href="alpine/clear-1000.html" target="_blank">Clear</a>
    </div>
  </div>

  <iframe id="benchmark-frame"></iframe>

  <script>
    const results = {
      k2: {},
      alpine: {}
    };

    function log(message, type = '') {
      const logEl = document.getElementById('log');
      const entry = document.createElement('div');
      entry.className = 'log-entry ' + type;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logEl.appendChild(entry);
      logEl.scrollTop = logEl.scrollHeight;
    }

    function clearResults() {
      document.querySelectorAll('td[id^="signal-"], td[id^="alpine-"], td[id^="winner-"]').forEach(el => {
        el.textContent = '-';
        el.className = '';
      });
      document.getElementById('log').innerHTML = '';
      results.k2 = {};
      results.alpine = {};
    }

    function updateResult(framework, benchmark, time) {
      results[framework][benchmark] = time;
      const cellId = `${framework === 'k2' ? 'signal' : 'alpine'}-${benchmark}`;
      const cell = document.getElementById(cellId);
      if (cell) {
        cell.textContent = `${time.toFixed(2)}ms`;
      }

      // Check if both results are in
      if (results.k2[benchmark] && results.alpine[benchmark]) {
        const winnerId = `winner-${benchmark}`;
        const winnerEl = document.getElementById(winnerId);
        if (winnerEl) {
          const signalTime = results.k2[benchmark];
          const alpineTime = results.alpine[benchmark];

          if (signalTime < alpineTime) {
            const diff = ((alpineTime - signalTime) / alpineTime * 100).toFixed(1);
            winnerEl.textContent = `K2 ${diff}% faster`;
            winnerEl.className = 'faster';
          } else if (alpineTime < signalTime) {
            const diff = ((signalTime - alpineTime) / signalTime * 100).toFixed(1);
            winnerEl.textContent = `Alpine ${diff}% faster`;
            winnerEl.className = 'slower';
          } else {
            winnerEl.textContent = 'Tie';
            winnerEl.className = 'same';
          }
        }
      }
    }

    // Listen for messages from benchmark iframes
    window.addEventListener('message', (event) => {
      if (event.data && event.data.type === 'benchmark-result') {
        const { framework, benchmark, time } = event.data;
        log(`${framework} ${benchmark}: ${time.toFixed(2)}ms`, 'complete');
        updateResult(framework, benchmark, time);
      }
    });

    async function runBenchmark(framework, benchmarkFile, benchmarkName) {
      return new Promise((resolve) => {
        const frame = document.getElementById('benchmark-frame');
        const url = `${framework}/${benchmarkFile}?autorun=true`;
        log(`Running ${framework} ${benchmarkName}...`, 'running');

        const handler = (event) => {
          if (event.data && event.data.type === 'benchmark-result' &&
              event.data.framework === framework && event.data.benchmark === benchmarkName) {
            window.removeEventListener('message', handler);
            resolve(event.data.time);
          }
        };
        window.addEventListener('message', handler);

        frame.src = url;

        // Timeout after 60 seconds
        setTimeout(() => {
          window.removeEventListener('message', handler);
          log(`Timeout: ${framework} ${benchmarkName}`, 'error');
          resolve(null);
        }, 60000);
      });
    }

    async function runAllBenchmarks() {
      const btn = document.getElementById('runAll');
      btn.disabled = true;
      clearResults();

      const benchmarks = [
        { file: 'create-1000.html', name: 'create' },
        { file: 'create-10000.html', name: 'create10k' },
        { file: 'append-1000.html', name: 'append' },
        { file: 'update-1000.html', name: 'update' },
        { file: 'select-row.html', name: 'select' },
        { file: 'remove-row.html', name: 'remove' },
        { file: 'swap-1000.html', name: 'swap' },
        { file: 'clear-1000.html', name: 'clear' }
      ];
      const frameworks = ['k2', 'alpine'];

      for (const benchmark of benchmarks) {
        for (const framework of frameworks) {
          const time = await runBenchmark(framework, benchmark.file, benchmark.name);
          if (time !== null) {
            updateResult(framework, benchmark.name, time);
          }
          // Small delay between benchmarks
          await new Promise(r => setTimeout(r, 500));
        }
      }

      btn.disabled = false;
      log('All benchmarks complete!', 'complete');
    }
  </script>
</body>
</html>
